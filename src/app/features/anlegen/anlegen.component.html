<div class="anlegen-container page-container">
  <h1 class="page-title">
    <mat-icon>add_circle</mat-icon>
    Neues Buch anlegen
  </h1>

  <mat-card class="form-card slide-up">
    <mat-card-header>
      <mat-icon mat-card-avatar class="form-icon">menu_book</mat-icon>
      <mat-card-title>Buchinformationen</mat-card-title>
      <mat-card-subtitle>Alle Pflichtfelder sind mit * markiert</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <!-- Fehlermeldung -->
      @if (buchService.error()) {
      <div class="error-container fade-in">
        <mat-icon>error</mat-icon>
        <span>{{ buchService.error() }}</span>
      </div>
      }

      <form [formGroup]="buchForm" (ngSubmit)="onSubmit()" class="buch-form">
        <!-- Titel und Untertitel -->
        <div class="form-section">
          <h3 class="section-title">Titel</h3>
          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Titel *</mat-label>
              <input matInput formControlName="titel" placeholder="Buchtitel eingeben" />
              <mat-icon matPrefix>title</mat-icon>
              @if (buchForm.get('titel')?.invalid && buchForm.get('titel')?.touched) {
              <mat-error>{{ getErrorMessage('titel') }}</mat-error>
              }
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Untertitel</mat-label>
              <input matInput formControlName="untertitel" placeholder="Optionaler Untertitel" />
              <mat-icon matPrefix>subtitles</mat-icon>
            </mat-form-field>
          </div>
        </div>

        <!-- ISBN -->
        <div class="form-section">
          <h3 class="section-title">Identifikation</h3>
          <mat-form-field appearance="outline" class="form-field-wide">
            <mat-label>ISBN-13 *</mat-label>
            <input matInput formControlName="isbn" placeholder="z.B. 978-3-16-148410-0" />
            <mat-icon matPrefix>qr_code</mat-icon>
            <mat-hint>Format: 978-X-XXX-XXXXX-X oder ohne Bindestriche</mat-hint>
            @if (buchForm.get('isbn')?.invalid && buchForm.get('isbn')?.touched) {
            <mat-error>{{ getErrorMessage('isbn') }}</mat-error>
            }
          </mat-form-field>
        </div>

        <!-- Art und Rating -->
        <div class="form-section">
          <h3 class="section-title">Eigenschaften</h3>
          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Art *</mat-label>
              <mat-select formControlName="art">
                @for (art of buchArtOptions; track art) {
                <mat-option [value]="art">{{ art }}</mat-option>
                }
              </mat-select>
              <mat-icon matPrefix>category</mat-icon>
            </mat-form-field>

            <div class="rating-field">
              <label for="rating-slider" class="rating-label">Rating: {{ buchForm.get('rating')?.value }} Sterne</label>
              <mat-slider min="0" max="5" step="1" discrete class="rating-slider">
                <input id="rating-slider" matSliderThumb formControlName="rating" />
              </mat-slider>
            </div>
          </div>
        </div>

        <!-- Preis und Rabatt -->
        <div class="form-section">
          <h3 class="section-title">Preisgestaltung</h3>
          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Preis (€) *</mat-label>
              <input matInput type="number" formControlName="preis" placeholder="z.B. 29.99" step="0.01" />
              <mat-icon matPrefix>euro</mat-icon>
              @if (buchForm.get('preis')?.invalid && buchForm.get('preis')?.touched) {
              <mat-error>{{ getErrorMessage('preis') }}</mat-error>
              }
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Rabatt (0-1)</mat-label>
              <input matInput type="number" formControlName="rabatt" placeholder="z.B. 0.1 für 10%" step="0.01" min="0"
                max="1" />
              <mat-icon matPrefix>local_offer</mat-icon>
              <mat-hint>0.1 = 10% Rabatt</mat-hint>
              @if (buchForm.get('rabatt')?.invalid && buchForm.get('rabatt')?.touched) {
              <mat-error>{{ getErrorMessage('rabatt') }}</mat-error>
              }
            </mat-form-field>
          </div>
        </div>

        <!-- Verfügbarkeit und Datum -->
        <div class="form-section">
          <h3 class="section-title">Verfügbarkeit</h3>
          <div class="form-row">
            <mat-checkbox formControlName="lieferbar" class="checkbox-field">
              Lieferbar
            </mat-checkbox>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Erscheinungsdatum</mat-label>
              <input matInput [matDatepicker]="picker" formControlName="datum" />
              <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
              <mat-icon matPrefix>calendar_today</mat-icon>
            </mat-form-field>
          </div>
        </div>

        <!-- Zusätzliche Infos -->
        <div class="form-section">
          <h3 class="section-title">Zusätzliche Informationen</h3>
          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Homepage</mat-label>
              <input matInput formControlName="homepage" placeholder="https://example.com" />
              <mat-icon matPrefix>language</mat-icon>
              @if (buchForm.get('homepage')?.invalid && buchForm.get('homepage')?.touched) {
              <mat-error>{{ getErrorMessage('homepage') }}</mat-error>
              }
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Schlagwörter</mat-label>
              <input matInput formControlName="schlagwoerter" placeholder="z.B. JAVASCRIPT, TYPESCRIPT" />
              <mat-icon matPrefix>label</mat-icon>
              <mat-hint>Komma-separiert eingeben</mat-hint>
            </mat-form-field>
          </div>
        </div>

        <!-- Buttons -->
        <div class="button-row">
          <button mat-raised-button color="primary" type="submit" [disabled]="isSubmitting() || buchForm.invalid">
            @if (isSubmitting()) {
            <mat-spinner diameter="20"></mat-spinner>
            <span>Wird angelegt...</span>
            } @else {
            <ng-container>
              <mat-icon>save</mat-icon>
              <span>Buch anlegen</span>
            </ng-container>
            }
          </button>
          <button mat-stroked-button type="button" (click)="abbrechen()">
            <mat-icon>cancel</mat-icon>
            Abbrechen
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>